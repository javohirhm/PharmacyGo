{% extends 'base.html' %}
{% block content %}
<section class="auth-shell">
    <div class="auth-card">
        <div class="auth-icon">ðŸ’Š</div>
        <h1>PharmacyGo</h1>
        <p class="auth-subtitle">Login to your account</p>
        {% with selected_role=form.role_hint.value|default:form.role_hint.field.initial|default:'customer' %}
        <div class="auth-tabs" data-auth-tabs data-target-input="{{ form.role_hint.id_for_label }}" data-selected-role="{{ selected_role }}">
            {% for value, label in form.role_hint.field.choices %}
                <button type="button" class="auth-tab{% if value == selected_role %} active{% endif %}" data-auth-role="{{ value }}" data-auth-label="{{ label }}">{{ label }}</button>
            {% endfor %}
        </div>
        {% endwith %}
        <form method="post" class="auth-form">
            {% csrf_token %}
            {{ form.role_hint }}
            {% if form.non_field_errors %}
                <div class="form-error">{{ form.non_field_errors.0 }}</div>
            {% endif %}
            <div class="input-field">
                <label data-identifier-label for="{{ form.username.id_for_label }}">Phone Number</label>
                {{ form.username }}
                {% for error in form.username.errors %}
                    <div class="form-error">{{ error }}</div>
                {% endfor %}
            </div>
            <div class="input-field">
                <label for="{{ form.password.id_for_label }}">Password</label>
                {{ form.password }}
                {% for error in form.password.errors %}
                    <div class="form-error">{{ error }}</div>
                {% endfor %}
            </div>
            <button class="btn-primary auth-submit" type="submit" data-auth-submit>Login</button>
        </form>
        <div class="auth-links">
            <a href="{% url 'forgot_password' %}">Forgot password?</a>
            <p>Don't have an account? <a href="{% url 'signup' %}">Sign up</a></p>
        </div>
    </div>
</section>
{% endblock %}
{% block extra_js %}
    {{ block.super }}
    <script>
        (function () {
            const tabs = document.querySelectorAll('[data-auth-role]');
            const hiddenInput = document.getElementById('{{ form.role_hint.id_for_label }}') || document.getElementById('id_role_hint');
            const submitBtn = document.querySelector('[data-auth-submit]');
            const identifierLabel = document.querySelector('[data-identifier-label]');
            const identifierInput = document.getElementById('{{ form.username.id_for_label }}');
            if (!hiddenInput || !tabs.length || !identifierInput) {
                return;
            }
            const configs = {
                customer: {
                    identifierLabel: 'Phone Number',
                    placeholder: '+998 90 123 45 67',
                    button: 'Login as customer',
                },
                admin: {
                    identifierLabel: 'Email address',
                    placeholder: 'admin@pharmacygo.uz',
                    button: 'Login as admin',
                },
                distributor: {
                    identifierLabel: 'Email address',
                    placeholder: 'ops@fleet.uz',
                    button: 'Login as distributor',
                },
                pharmacy: {
                    identifierLabel: 'Email address',
                    placeholder: 'store@pharmacygo.uz',
                    button: 'Login as pharmacy store',
                },
            };
            const setActive = (role, labelText) => {
                hiddenInput.value = role;
                tabs.forEach((tab) => {
                    tab.classList.toggle('active', tab.dataset.authRole === role);
                });
                const config = configs[role] || configs.customer;
                if (identifierLabel) {
                    identifierLabel.textContent = config.identifierLabel;
                }
                identifierInput.placeholder = config.placeholder;
                if (submitBtn) {
                    submitBtn.textContent = config.button;
                }
            };
            tabs.forEach((tab) => {
                tab.addEventListener('click', () => {
                    setActive(tab.dataset.authRole, tab.dataset.authLabel);
                });
            });
            setActive(hiddenInput.value || 'customer');
        })();
    </script>
{% endblock %}
